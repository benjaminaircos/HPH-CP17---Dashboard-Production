<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPH CP17 - Dashboard Production</title>
    <link rel="stylesheet" href="dashboard-style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š HPH CP17 - Dashboard Production</h1>
            <p class="subtitle">Analyse et suivi en temps rÃ©el</p>
            <div class="header-actions">
                <a href="index.html" class="btn btn-secondary">ğŸ“ Retour Ã  la saisie</a>
                <button onclick="chargerDonnees()" class="btn btn-primary">ğŸ”„ Actualiser</button>
                <button onclick="exporterPDF()" class="btn btn-pdf">ğŸ“„ Exporter PDF</button>
            </div>
        </header>

        <!-- Filtres -->
        <div class="filters-section">
            <h2>ğŸ” Filtres</h2>
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="filterDateDebut">ğŸ“… Date DÃ©but :</label>
                    <input type="date" id="filterDateDebut">
                </div>
                <div class="filter-group">
                    <label for="filterDateFin">ğŸ“… Date Fin :</label>
                    <input type="date" id="filterDateFin">
                </div>
                <div class="filter-group">
                    <label for="filterEquipe">ğŸ‘¥ Ã‰quipe :</label>
                    <select id="filterEquipe">
                        <option value="">Toutes les Ã©quipes</option>
                        <option value="Matin">Matin</option>
                        <option value="Soir">Soir</option>
                        <option value="Nuit">Nuit</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button onclick="appliquerFiltres()" class="btn btn-filter">âœ… Appliquer</button>
                    <button onclick="reinitialiserFiltres()" class="btn btn-reset-filter">ğŸ”„ RÃ©initialiser</button>
                </div>
            </div>
        </div>

        <!-- Objectifs -->
        <div class="objectifs-section">
            <h2>ğŸ¯ Objectifs de Production</h2>
            <p style="font-style: italic; color: #856404; margin-top: 5px; margin-bottom: 15px;">Informations Ã  saisir manuellement</p>
            <div class="objectifs-grid">
                <div class="objectif-group">
                    <label for="referenceObjectif">ğŸ”– RÃ©fÃ©rence Produit :</label>
                    <input type="text" id="referenceObjectif" placeholder="Ex: U455001" onblur="rechercherObjectifsReference()">
                    <small style="color: #666; font-style: italic;">Tapez une rÃ©fÃ©rence pour charger ses objectifs automatiquement</small>
                </div>
                <div class="objectif-group">
                    <label for="objectifProdEquipe">ğŸ“¦ Objectif Production / Ã‰quipe :</label>
                    <input type="number" id="objectifProdEquipe" value="5000" min="0">
                </div>
                <div class="objectif-group">
                    <label for="objectifTauxRebuts">ğŸ“Š Objectif Taux Rebuts Max (%) :</label>
                    <input type="number" id="objectifTauxRebuts" value="5" min="0" max="100" step="0.1">
                </div>
                <div class="objectif-group">
                    <label for="objectifTRS">ğŸ“ˆ Objectif TRS (%) :</label>
                    <input type="number" id="objectifTRS" value="85" min="0" max="100" step="0.1">
                </div>
                <div class="objectif-group">
                    <label for="cadenceInstantanee">âš™ï¸ Cadence InstantanÃ©e (piÃ¨ces/minute) :</label>
                    <input type="number" id="cadenceInstantanee" value="15" min="0" step="0.1">
                </div>
                <div class="objectif-group">
                    <button onclick="appliquerObjectifs()" class="btn btn-objectif">âœ… Appliquer au Dashboard</button>
                </div>
                <div class="objectif-group">
                    <button onclick="enregistrerObjectifsReference()" class="btn btn-save-objectif">ğŸ’¾ Enregistrer pour cette RÃ©fÃ©rence</button>
                    <small id="messageEnregistrement" style="display: block; margin-top: 5px; font-weight: bold;"></small>
                </div>
            </div>
        </div>

        <!-- KPIs -->
        <div class="kpi-section">
            <div class="kpi-card" id="kpiCardProdTotal">
                <div class="kpi-icon">ğŸ“¦</div>
                <div class="kpi-content">
                    <div class="kpi-label">Production Totale</div>
                    <div class="kpi-value" id="kpiProdTotal">0</div>
                    <div class="kpi-objectif" id="kpiObjectifProd"></div>
                    <div class="kpi-status" id="kpiStatusProd"></div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon">âœ…</div>
                <div class="kpi-content">
                    <div class="kpi-label">Production Bonne</div>
                    <div class="kpi-value" id="kpiProdBonne">0</div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon">âŒ</div>
                <div class="kpi-content">
                    <div class="kpi-label">Rebuts</div>
                    <div class="kpi-value" id="kpiRebuts">0</div>
                </div>
            </div>
            <div class="kpi-card" id="kpiCardTauxRebuts">
                <div class="kpi-icon">ğŸ“Š</div>
                <div class="kpi-content">
                    <div class="kpi-label">Taux de Rebuts</div>
                    <div class="kpi-value" id="kpiTauxRebuts">0%</div>
                    <div class="kpi-objectif" id="kpiObjectifRebuts"></div>
                    <div class="kpi-status" id="kpiStatusRebuts"></div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon">â±ï¸</div>
                <div class="kpi-content">
                    <div class="kpi-label">Temps d'ArrÃªt Total</div>
                    <div class="kpi-value" id="kpiTempsArret">0 min</div>
                </div>
            </div>
            <div class="kpi-card" id="kpiCardTRSGlobal" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                <div class="kpi-icon">ğŸ“ˆ</div>
                <div class="kpi-content">
                    <div class="kpi-label">TRS Global</div>
                    <div class="kpi-value" id="kpiTRSGlobal">0%</div>
                    <div class="kpi-objectif" id="kpiObjectifTRSGlobal"></div>
                    <div class="kpi-status" id="kpiStatusTRSGlobal"></div>
                </div>
            </div>
        </div>

        <!-- Graphiques HORAIRES (une seule date) -->
        <div id="graphiques-horaires">
            <div class="charts-section">
                <div class="chart-container">
                    <h3>ğŸ“ˆ Production par Heure</h3>
                    <canvas id="chartProductionHeure"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ğŸ“Š TRS par Heure <span class="info-icon" title="Formule: TRS = (Prod Bonne + Rebuts) / (Cadence Ã— 60) Ã— 100
Prod Max Machine = Cadence (piÃ¨ces/min) Ã— 60 minutes">â„¹ï¸</span></h3>
                    <canvas id="chartTRS"></canvas>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3>âš¡ Taux de Performance par Heure <span class="info-icon" title="Formule: Performance = (Prod Bonne + Rebuts) / (Cadence Ã— (60 - ArrÃªts)) Ã— 100
Prod ThÃ©orique = Cadence (piÃ¨ces/min) Ã— Temps productif (60 min - temps d'arrÃªts)">â„¹ï¸</span></h3>
                    <canvas id="chartPerformance"></canvas>
                </div>
                <div class="chart-container">
                    <h3>âš ï¸ Temps Non JustifiÃ© par Heure (minutes)</h3>
                    <canvas id="chartProductionEquipe"></canvas>
                </div>
            </div>
        </div>

        <!-- Graphiques JOURNALIERS (plusieurs dates) -->
        <div id="graphiques-journaliers" style="display: none;">
            <div class="charts-section">
                <div class="chart-container">
                    <h3>ğŸ“ˆ Production Bonne par Jour</h3>
                    <canvas id="chartProductionJour"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ğŸ“Š TRS par Jour <span class="info-icon" title="Formule: TRS = (Prod Bonne + Rebuts) / (Cadence Ã— 60 Ã— 8h Ã— Nb Ã©quipes) Ã— 100">â„¹ï¸</span></h3>
                    <canvas id="chartTRSJour"></canvas>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3>âš¡ Taux de Performance par Jour <span class="info-icon" title="Formule: Performance = (Prod Bonne + Rebuts) / (Cadence Ã— (8h Ã— 60 - ArrÃªts)) Ã— 100">â„¹ï¸</span></h3>
                    <canvas id="chartPerformanceJour"></canvas>
                </div>
                <div class="chart-container">
                    <h3>âš ï¸ Temps Non JustifiÃ© par Jour (minutes)</h3>
                    <canvas id="chartTempsNonJustifieJour"></canvas>
                </div>
            </div>
        </div>

        <div class="charts-section">
                <h3>â±ï¸ DurÃ©e des ArrÃªts par CatÃ©gorie</h3>
                <canvas id="chartDureeArrets"></canvas>
            </div>
        </div>

        <!-- Tableau dÃ©taillÃ© -->
        <div class="table-section">
            <h2>ğŸ“‹ DonnÃ©es DÃ©taillÃ©es</h2>
            <div class="table-controls">
                <button onclick="exporterCSV()" class="btn btn-export">ğŸ’¾ Exporter en CSV</button>
            </div>
            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>RÃ©fÃ©rence</th>
                            <th>Trigramme</th>
                            <th>Ã‰quipe</th>
                            <th>Heure</th>
                            <th>Prod Bonne</th>
                            <th>Rebuts</th>
                            <th>Ã‰quipement</th>
                            <th>DurÃ©e Ã‰quip.</th>
                            <th>QualitÃ©</th>
                            <th>DurÃ©e QualitÃ©</th>
                            <th>Organisation</th>
                            <th>DurÃ©e Org.</th>
                            <th>Autres</th>
                            <th>DurÃ©e Autres</th>
                            <th>Commentaire</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Les donnÃ©es seront insÃ©rÃ©es ici -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Message de chargement -->
        <div id="loadingMessage" class="loading-message">
            <div class="spinner"></div>
            <p>Chargement des donnÃ©es...</p>
        </div>

        <!-- Message d'erreur -->
        <div id="errorMessage" class="error-message" style="display: none;">
            <p>âŒ Erreur lors du chargement des donnÃ©es. Veuillez rÃ©essayer.</p>
        </div>
    </div>

    <script src="dashboard-script.js"></script>
</body>
</html>
